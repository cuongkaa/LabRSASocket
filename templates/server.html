
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server - X√°c th·ª±c ch·ªØ k√Ω</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .data-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        .key-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
            word-break: break-all;
        }
        .verification-result {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .valid {
            background: #d4edda;
            color: #155724;
            border: 3px solid #28a745;
        }
        .invalid {
            background: #f8d7da;
            color: #721c24;
            border: 3px solid #dc3545;
        }
        .waiting {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #218838;
        }
    </style>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏è Server - X√°c th·ª±c ch·ªØ k√Ω</h1>
        <p>Nh·∫≠n v√† x√°c th·ª±c ch·ªØ k√Ω t·ª´ Client</p>

        <div id="connectionStatus" class="status">
            ƒêang k·∫øt n·ªëi...
        </div>

        <div id="waitingArea" class="waiting">
            <h3>üîç ƒêang ch·ªù d·ªØ li·ªáu t·ª´ Client...</h3>
            <p>Vui l√≤ng th·ª±c hi·ªán quy tr√¨nh k√Ω ·ªü tab Client</p>
        </div>

        <div id="dataArea" style="display: none;">
            <h3>üìÑ Th√¥ng tin file nh·∫≠n ƒë∆∞·ª£c:</h3>
            <div class="data-display">
                <strong>T√™n file:</strong> <span id="fileName"></span><br>
                <strong>Hash:</strong> <span id="receivedHash" class="key-display"></span>
            </div>

            <h3>üîë Public Key t·ª´ Client:</h3>
            <div class="key-display" id="publicKeyReceived"></div>

            <h3>‚úçÔ∏è Ch·ªØ k√Ω nh·∫≠n ƒë∆∞·ª£c:</h3>
            <div class="key-display" id="signatureReceived"></div>

            <button id="verifyBtn">üîç X√°c th·ª±c ch·ªØ k√Ω</button>
        </div>

        <div id="verificationArea" style="display: none;">
            <h3>üìã K·∫øt qu·∫£ x√°c th·ª±c:</h3>
            <div id="verificationResult" class="verification-result"></div>
            <div id="verificationDetails"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let receivedData = {};

        // K·∫øt n·ªëi socket
        socket.on('connect', function() {
            document.getElementById('connectionStatus').innerHTML = '‚úÖ ƒê√£ k·∫øt n·ªëi ƒë·∫øn server';
            document.getElementById('connectionStatus').className = 'status success';
            socket.emit('join_room', {room: 'server'});
        });

        socket.on('disconnect', function() {
            document.getElementById('connectionStatus').innerHTML = '‚ùå M·∫•t k·∫øt n·ªëi';
            document.getElementById('connectionStatus').className = 'status error';
        });

        // Nh·∫≠n th√¥ng tin file
        socket.on('file_info', function(data) {
            console.log('Received file info:', data);
            document.getElementById('waitingArea').innerHTML = 
                '<div class="status warning">üìÅ ƒê√£ nh·∫≠n file: ' + data.filename + '<br>‚è≥ ƒêang ch·ªù ch·ªØ k√Ω...</div>';
        });

        // Nh·∫≠n ch·ªØ k√Ω
        socket.on('signature_received', function(data) {
            console.log('Received signature:', data);
            receivedData = data;
            
            // ·∫®n waiting area
            document.getElementById('waitingArea').style.display = 'none';
            
            // Hi·ªÉn th·ªã d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c
            document.getElementById('dataArea').style.display = 'block';
            document.getElementById('fileName').textContent = data.filename;
            document.getElementById('receivedHash').textContent = data.hash;
            document.getElementById('publicKeyReceived').textContent = data.public_key;
            document.getElementById('signatureReceived').textContent = data.signature;
        });

        // X√°c th·ª±c ch·ªØ k√Ω
        document.getElementById('verifyBtn').addEventListener('click', function() {
            if (receivedData.signature) {
                socket.emit('verify_signature', {
                    public_key: receivedData.public_key,
                    hash: receivedData.hash,
                    signature: receivedData.signature,
                    filename: receivedData.filename
                });
            }
        });

        // K·∫øt qu·∫£ x√°c th·ª±c
        socket.on('verification_result', function(data) {
            document.getElementById('verificationArea').style.display = 'block';
            
            const resultDiv = document.getElementById('verificationResult');
            const detailsDiv = document.getElementById('verificationDetails');
            
            if (data.is_valid) {
                resultDiv.innerHTML = '‚úÖ CH·ªÆ K√ù H·ª¢P L·ªÜ';
                resultDiv.className = 'verification-result valid';
                detailsDiv.innerHTML = `
                    <div class="status success">
                        <strong>‚úÖ X√°c th·ª±c th√†nh c√¥ng!</strong><br>
                        üìÑ File: ${data.filename}<br>
                        üîí Ch·ªØ k√Ω ƒë∆∞·ª£c t·∫°o b·ªüi ch·ªß s·ªü h·ªØu Private Key<br>
                        üõ°Ô∏è D·ªØ li·ªáu kh√¥ng b·ªã thay ƒë·ªïi
                    </div>
                `;
            } else {
                resultDiv.innerHTML = '‚ùå CH·ªÆ K√ù KH√îNG H·ª¢P L·ªÜ';
                resultDiv.className = 'verification-result invalid';
                detailsDiv.innerHTML = `
                    <div class="status error">
                        <strong>‚ùå X√°c th·ª±c th·∫•t b·∫°i!</strong><br>
                        üìÑ File: ${data.filename}<br>
                        ‚ö†Ô∏è Ch·ªØ k√Ω kh√¥ng kh·ªõp ho·∫∑c d·ªØ li·ªáu ƒë√£ b·ªã thay ƒë·ªïi<br>
                        üö´ Kh√¥ng th·ªÉ tin t∆∞·ªüng v√†o t√≠nh to√†n v·∫πn c·ªßa d·ªØ li·ªáu
                    </div>
                `;
            }
        });

        // X·ª≠ l√Ω l·ªói
        socket.on('error', function(data) {
            alert('L·ªói: ' + data.message);
        });
    </script>
</body>
</html>
